<div class="main-container">

    <div class="left-menu-area" #leftmenu>

        <div class="left-menu-top">
            <button mat-icon-button (click)="toggleLeftMenu()">
                <mat-icon *ngIf="!isShrunk">chevron_left</mat-icon>
                <mat-icon *ngIf="isShrunk">chevron_right</mat-icon>
            </button>
        </div>

        <div class="left-menu-bottom" *ngIf="isShrunk">
            <button mat-icon-button [matMenuTriggerFor]="chans">
                <mat-icon>forum</mat-icon>
                <mat-menu #chans="matMenu">
                    <p style="margin-left: 8px;">Channels</p>
                    <ng-container *ngIf="channels() && channels().length; else noChannelsSmall">
                        <button mat-menu-item *ngFor="let channel of channels()"
                            (click)="switchToChannel(channel)"><mat-icon>forum</mat-icon>{{channel.name}}</button>
                    </ng-container>
                    <ng-template #noChannelsSmall>
                        <span>No channels yet</span>
                        <button mat-menu-item joinChannel><mat-icon>login</mat-icon> Join Channel</button>
                        <button mat-menu-item><mat-icon>add</mat-icon> Create Channel</button>
                    </ng-template>
                </mat-menu>
            </button>

            <button mat-icon-button [matMenuTriggerFor]="dms">
                <mat-icon>3p</mat-icon>
                <mat-menu #dms="matMenu">
                    <p style="margin-left: 8px;">Direct Messages</p>
                    <ng-container *ngIf="directMessages() && directMessages().length; else noDMSmall">
                        <button mat-menu-item *ngFor="let dm of directMessages()"
                            (click)="switchToChannel(dm)"><mat-icon>3p</mat-icon>{{returnChatpartner(dm.members)}}</button>
                    </ng-container>
                    <ng-template #noDMSmall>
                        <span>No messages yet</span>
                        <button mat-menu-item><mat-icon>add</mat-icon> Write Someone</button>
                    </ng-template>
                </mat-menu>
            </button>
        </div>

        <div class="left-menu-bottom" *ngIf="!isShrunk">

            <button mat-button (click)="showChannels = !showChannels">
                Channels
                <mat-icon *ngIf="!showChannels">chevron_right</mat-icon>
                <mat-icon *ngIf="showChannels">chevron_left</mat-icon>
            </button>
            <ng-container *ngIf="showChannels">
                <ng-container *ngIf="channels() && channels().length; else noChannelsBig">
                    <button mat-button joinChannel><mat-icon>login</mat-icon> Join Channel</button>
                    <button mat-button><mat-icon>add</mat-icon> Create Channel</button>
                    <button mat-button *ngFor="let channel of channels()"
                        (click)="switchToChannel(channel)"><mat-icon>forum</mat-icon> {{channel.name}}</button>
                </ng-container>
                <ng-template #noChannelsBig>
                    <button mat-button joinChannel><mat-icon>login</mat-icon> Join Channel</button>
                    <button mat-button><mat-icon>add</mat-icon> Create Channel</button>
                    <span>No channels yet</span>
                </ng-template>
            </ng-container>

            <div class="line"></div>

            <button mat-button (click)="showDMs = !showDMs">
                Direct Messages
                <mat-icon *ngIf="!showDMs">chevron_right</mat-icon>
                <mat-icon *ngIf="showDMs">chevron_left</mat-icon>
            </button>
            <ng-container *ngIf="showDMs">
                <ng-container *ngIf="directMessages() && directMessages().length; else noDMBig">
                    <button mat-button><mat-icon>add</mat-icon> Write Someone</button>
                    <button mat-button *ngFor="let dm of directMessages()"
                        (click)="switchToChannel(dm)"><mat-icon>3p</mat-icon> {{returnChatpartner(dm.members)}}
                    </button>
                </ng-container>
                <ng-template #noDMBig>
                    <button mat-button><mat-icon>add</mat-icon> Write Someone</button>
                    <span>No messages yet</span>
                </ng-template>
            </ng-container>
        </div>


    </div>

    <div class="content-container hide-overflow" #content>
        <ng-container *ngIf="channel(); else showButton">
            <div class="content-top-area">
                <span class="channel-title">{{channel()?.name || "Title"}}</span>
                <span>Created on {{channel()?.created | date: "short" || ""}} by {{channel()?.createdBy?.fullName ||
                    "..."}}.</span>
                <span class="description">Description: {{channel()?.description || "..."}}</span>
                <span class="members-area">
                    <span class="members-list">
                        <span>Members:</span>
                        <ng-container *ngIf="channel(); else noCurrentChannel">
                            <button mat-button *ngFor="let member of channel()?.members">
                                <mat-icon>person</mat-icon>{{member.fullName}}
                            </button>
                        </ng-container>
                        <ng-template #noCurrentChannel>
                            <span>...</span>
                        </ng-template>
                    </span>
                    <span class="more-btn">
                        <span>Members:</span>
                        <button mat-icon-button [matMenuTriggerFor]="menu">
                            <mat-icon>more_horiz</mat-icon>
                            <mat-menu #menu="matMenu">
                                <ng-container *ngIf="channel(); else noCurrentChannelSmall">
                                    <button mat-menu-item *ngFor="let member of channel()?.members">
                                        <mat-icon>person</mat-icon>{{member.fullName}}
                                    </button>
                                </ng-container>
                                <ng-template #noCurrentChannelSmall>
                                    <span>...</span>
                                </ng-template>
                            </mat-menu>
                        </button>
                    </span>
                </span>
            </div>

            <div class="content-bottom-area" #messagesArea>
                <ng-container *ngIf="messages() && messages().length; else noMessages">
                    <div class="message" *ngFor="let message of messages()">
                        <img style="width: 40px; border-radius: 16px; object-fit: contain;"
                            [src]="message.createdBy.image" alt="profile picture">
                        <mat-card>
                            <mat-card-content style="display: flex; flex-direction: column;">
                                <span
                                    style="font-size: 12px; line-height: 0.5; margin-bottom: 8px; color: var(--font-light);">{{message.createdBy.fullName}}
                                    - {{message.created | date: "short"}}</span>
                                <span [innerHTML]="getSanitizedMessage(message.content)"></span>
                            </mat-card-content>
                        </mat-card>
                    </div>
                </ng-container>
                <ng-template #noMessages>
                    <span>No messages yet</span>
                </ng-template>


            </div>

            <div style="margin-left: 8px; margin-right: 8px; margin-top: 8px; position: relative;">
                <app-quill-bubble (messageSent)="scrollToLatestMessage($event)"></app-quill-bubble>
            </div>

        </ng-container>
        <ng-template #showButton>
            <div class="empty-channel">
                <span>Join or create a channel</span>
                <button mat-raised-button joinChannel><mat-icon>login</mat-icon> Join Channel</button>
                <button mat-raised-button><mat-icon>add</mat-icon> Create Channel</button>
                <button mat-raised-button><mat-icon>add</mat-icon> Write Direct Message</button>
            </div>
        </ng-template>
    </div>



</div>